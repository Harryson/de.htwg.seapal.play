{
  "_id": "_design/Mark",
  "language": "coffeescript",
  "views": {
    "marksOfRoute": {
      "map": "(doc)->\n if doc? and doc._id? and not doc._deleted and doc.route? and doc.route.length? and doc.route.length > 0\n  if doc.owner? and doc.owner.length? and doc.owner.length > 0\n   emit \"#{doc.owner}#{doc.route}\", doc\n  if doc.crew? and doc.crew.length? and doc.crew.length > 0\n   for crew_member of doc.crew\n    emit \"#{doc.crew[crew_member]}#{doc.route}\", doc\n"
    },
    "markAsJson": {
      "map": "(doc)->\n if doc? and doc._id? and not doc._deleted\n  if doc.owner? and doc.owner.length? and doc.owner.length > 0\n   emit \"#{doc.owner}#{doc._id}\", doc\n  if doc.crew? and doc.crew.length? and doc.crew.length > 0\n   for crew_member of doc.crew\n    emit \"#{doc.crew[crew_member]}#{doc._id}\", doc\n"
    },
    "standaloneMarks": {
      "map": "(doc)->\n if doc? and doc._id? and not doc._deleted and (not doc.route? or (doc.route.length? and doc.route.length = 0))\n  if doc.owner? and doc.owner.length? and doc.owner.length > 0\n   emit \"#{doc.owner}\", doc\n  if doc.crew? and doc.crew.length? and doc.crew.length > 0\n   for crew_member of doc.crew\n    emit \"#{doc.crew[crew_member]}\", doc\n"
    }
  },
  "validate_doc_update": "(newDoc,oldDoc,userCtx) ->\n if oldDoc? and not newDoc._deleted? and newDoc.owner isnt oldDoc.owner\n  throw forbidden: 'old and new user dont match'"
}
